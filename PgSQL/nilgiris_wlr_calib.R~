## This script should work on both Linux and Mac
dir_calib_wlr<-"/home/udumbu/rsb/OngoingProjects/CWC/Data/Nilgiris/wlr/calib/" # fix this according to your directory
dir_calib_res<-"/home/udumbu/rsb/OngoingProjects/CWC/Data/Nilgiris/wlr/calibres/" # fix this according to your directory
wlr_calib_list <- system(paste("ls", dir_calib_wlr, sep=" "), intern=TRUE)
col_names <- c("y", "x")
for (i in 1: length(wlr_calib_list)){
    wlr_nme <- substr(wlr_calib_list[i], 1,7) # hold name of wlr
    sh_stm <- paste("tail -n +7 ", dir_calib_wlr, wlr_calib_list[i]," > tmp",i,  sep="") # create the shell statement
    system(sh_stm) # run the statement, assign the values to the wlr name (tmp)
    tmp <- read.table(paste("./tmp", i, sep=""), col.names=col_names)
    lmtmp <- lm(tmp$y~tmp$x) # run the linear regression
    summary_lmtmp <- summary(lmtmp) # output the results into a temporary file
    out <- capture.output(summary_lmtmp) # save them to a temporary file for recording
    outsum <- paste(dir_calib_res, wlr_nme, ".txt", sep="") # define output text file
    cat(out,file=outsum,sep="\n",append=TRUE) # dump to the text file
    ## Now plot the regression and abline
    outfig <- paste(dir_calib_res, wlr_nme, ".png", sep="") # define output figure name
    png(filename=outfig, width=480, height=480, units="px", pointsize=12, type="cairo") # set up the export to file
    plot(tmp$x, tmp$y, xlab="Capacitance", ylab="Water Level", main=wlr_nme) # plot it
    abline(lmtmp, lwd=2, col=2) # add line for intercept and slope (a-b)
    dev.off() # write the plot to file
    ##lmtmp$coefficients[1]+(lmtmp$coefficients[2]*[capacitance]) # formula to use for WLR levels in mm
    ## Make a call to the routine for calibration here
}
