## Load required libraries
library(RPostgreSQL)
library(yaml)
library(stringr) # to manipulate strings
## Set directory locations
rdata.dr <- "/home/udumbu/rsb/OngoingProjects/CWC/rdata/"
csvdir <- "/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/csv/"
figdir <- "/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/fig/"
site <- "agnashini."
wlrdatadir<-"/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/raw/"
dir_calib_wlr<-"/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/calib/" # fix this according to your directory
dir_calib_res<-"/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/calibres/" # fix this according to your directory
wlr.nulldir <- "/home/udumbu/rsb/OngoingProjects/CWC/Data/Aghnashini/wlr/null/" # null dir location
setwd(rdata.dr) # set the working directory
# num_wlr<-c("001","002", "003")
num_wlr<-c("001","002","003","03b","004","04b","005","006","010","011", "020", "021") # the number of wlr
loggers <- paste("wlr_", num_wlr, sep="")
## Establish the database connection
conf <- yaml.load_file(paste(rdata.dr,"db.config.yml", sep="")) # this is to avoid sharing credentials for the database
con <- dbConnect(PostgreSQL(), host=conf$db$host, dbname=conf$db$name, user=conf$db$user, password=conf$db$pass)
## call the routines
source("wlr_calib.R", echo=TRUE) # build calibration results
setwd(rdata.dr) # set the working directory
source("wlr_imp.R", echo=TRUE) # import data
setwd(rdata.dr) # set the working directory
source("wlr_null.R", echo=TRUE) # insert null values from error logs
setwd(rdata.dr) # set the working directory
source("wlr_aggreg.R", echo=TRUE) # aggregate and output the data
## Wrap up
postgresqlCloseConnection(con) # close the database connection
## add here to remove temporary files



